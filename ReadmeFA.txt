=== درگاه‌های چندگانه دیجی‌پی برای ووکامرس ===
همکاران: Mr4bby
برچسب‌ها: پرداخت، درگاه، دیجی‌پی، ووکامرس، ایران، کیف‌پول، IPG، BPG، CPG
حداقل نسخه مورد نیاز: 5.0
تست شده تا: 6.0
نسخه پایدار: 1.0.0
مجوز: GPLv2 یا نسخه‌های بعدی
آدرس مجوز: https://www.gnu.org/licenses/gpl-2.0.html

== توضیحات ==
افزونه Digipay Multi Gateways چهار روش پرداخت مبتنی بر دیجی‌پی را به ووکامرس اضافه می‌کند:

BPG (خرید فوری و پرداخت بعدی)

CPG (پرداخت اقساطی)

کیف‌پول

IPG (درگاه مستقیم)

منطق پردازش و API در فایل‌های جداگانه قرار دارند. افزونه از محیط‌های تست (sandbox) و واقعی (live) پشتیبانی می‌کند و اطلاعات دسترسی در تنظیمات هر درگاه قابل پیکربندی است.

ویژگی‌های اصلی:

۴ درگاه ووکامرس: BPG، CPG، کیف‌پول، IPG

محیط‌های تست / واقعی

درخواست‌ها و تأییدیه‌های API مبتنی بر توکن

مدیریت بازگشتی (callback) کاربرپسند که صفحه‌ای به کاربر نمایش داده و ریدایرکت می‌کند

لاگر سبک داخلی با قابلیت اتصال اختیاری به wc_get_logger()

== نصب ==

پوشه digipay-gateways را در مسیر /wp-content/plugins/ آپلود کنید.

افزونه را از طریق صفحه «افزونه‌ها» در وردپرس فعال کنید.

به مسیر WooCommerce > تنظیمات > پرداخت‌ها بروید و هر درگاه دیجی‌پی را پیکربندی کنید.
نام کاربری، رمز عبور، client_id و client_secret را وارد کنید و در صورت نیاز از محیط تست استفاده کنید.

فایل‌های مهم:

Bootstrap افزونه: digipay.php

کلاس API: Digipay_MG_API

مدیریت callback / webhook: digipay_handle_gateway_response

کمک‌گیرنده لاگر: includes/logger.php

کلاس‌های درگاه:

BPG

CPG

کیف‌پول

IPG

== نحوه استفاده ==

وقتی مشتری سفارشی ثبت کرده و از طریق دیجی‌پی پرداخت می‌کند، دیجی‌پی endpoint بازگشتی (callback) را فراخوانی می‌کند.
این افزونه مدیریت callback را در مسیرهای زیر ثبت می‌کند:

هوک API قدیمی ووکامرس: /?wc-api=digipay_notify

مسیر REST: /wp-json/digipay/v1/notify

تأیید خریدها توسط افزونه از طریق توکن API انجام می‌شود که به صورت موقت در یک کوکی هنگام جریان callback ذخیره شده است.

== سوالات متداول ==

= چگونه به حالت تست / sandbox تغییر دهم؟ =
تنظیمات درگاه دیجی‌پی موردنظر را باز کنید و گزینه «محیط تستی» را روی «بله» قرار دهید. اطلاعات دسترسی برای محیط تست نیز مورد نیاز است.

= وضعیت پرداخت‌ها کجا ثبت می‌شود؟ =
متای سفارش برای ذخیره اطلاعات مرتبط با دیجی‌پی استفاده می‌شود، مانند:
_digipay_provider_id، _digipay_tracking_code، _digipay_handled و موارد دیگر.
افزونه همچنین وضعیت سفارش‌ها را با استفاده از API استاندارد ووکامرس به «تکمیل‌شده / ناموفق» تغییر می‌دهد.

= چگونه می‌توانم لاگ‌های افزونه را مشاهده کنم؟ =
اگر DIGIPAY_LOG برابر با true تعریف شده باشد و لاگر ووکامرس موجود باشد، افزونه از wc_get_logger() استفاده می‌کند.
در غیر این صورت، لاگر داخلی ساده استفاده می‌شود. جزئیات در includes/logger.php
 موجود است.

== تغییرات نسخه ==
= 1.0.0 =

انتشار اولیه: افزودن درگاه‌های BPG، CPG، کیف‌پول و IPG، کلاینت API، مدیریت callback و لاگ‌گیری پایه.

== تصاویر نمونه ==

گزینه‌های درگاه در مدیریت ووکامرس (عنوان‌ها، سوئیچ محیط تست، اطلاعات دسترسی)

صفحه بازگشتی کاربر (ریدایرکت موفقیت / شکست)

== اطلاعیه ارتقا ==
= 1.0.0 =
انتشار اولیه.

== پشتیبانی ==
mr4bby@gmail.com